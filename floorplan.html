<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>間取り分析＆3D表示</title>
  <link rel="stylesheet" href="styleMadori.css" />

  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/"
      }
    }
  </script>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <!-- <header class="appHeader">
    <div class="appHeader__inner">
      <div class="brand">
        <div class="brand__title">まどりめいく</div>
        <div class="brand__subtitle">間取り分析＆3D表示</div>
      </div>
    </div>
  </header> -->

  <main class="appMain">
    <div class="layout3">
      <!-- Left -->
      <section class="left-pane">
        <div class="card">
          <div class="card__head clickable" id="upload-header">
            <h2 class="card__title">間取り画像を選んで分析</h2>
            <p class="card__desc">画像を選択して Roboflow で解析します。</p>
          </div>
          <div class="card__body stack expanded" id="upload-container">
            <input id="imageInput" class="input" type="file" accept="image/*" />
            <img id="preview" class="preview" alt="プレビュー" />
            <div class="row">
              <button id="analyzeBtn" class="btn btnPrimary" type="button">分析（Roboflow）</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card__head">
            <h2 class="card__title">保存・読み込み</h2>
            <p class="card__desc">Google Drive に保存／読み込み（ログインが必要）。</p>
          </div>
          <div class="card__body stack">
            <div id="g_id_onload"
              data-client_id="479474446026-kej6f40kvfm6dsuvfeo5d4fm87c6god4.apps.googleusercontent.com"
              data-callback="handleCredentialResponse" data-auto_prompt="false"></div>
            <div class="g_id_signin" data-type="standard" data-size="medium" data-theme="outline"
              data-text="signin_with" data-shape="rectangular" data-logo_alignment="left"></div>

            <label class="field">
              <span class="field__label">保存名</span>
              <input id="filenameInput" class="input" type="text" placeholder="例: my_madori" />
            </label>

            <div class="row">
              <button id="saveBtn" class="btn btnPrimary" type="button">Driveに保存</button>
            </div>

            <label class="field">
              <span class="field__label">読み込み</span>
              <select id="fileSelect" class="select">
                <option value="">読み込むファイルを選択</option>
              </select>
            </label>

            <div class="row">
              <button id="loadBtn" class="btn" type="button">読み込み</button>
              <button id="deleteBtn" class="btn btnDanger" type="button">削除</button>
            </div>
          </div>
        </div>

        <!-- 分析結果JSON（UIは非表示。JSの書き込み先としてだけ残す） -->
        <div id="result-header" style="display:none;"></div>
        <div id="result-container" style="display:none;" class="collapsed">
          <pre id="result"></pre>
        </div>
      </section>

      <!-- Center: 3D -->
      <section class="center-pane">
        <div class="card cardFill">
          <div class="card__head">
            <h2 class="card__title">3D間取り表示</h2>
            <p class="card__desc">マウス左：移動　マウス右：回転　ホイール：拡大縮小</p>
          </div>
          <div class="card__body cardFill__body">
            <div id="three-container" class="threeContainer"></div>
          </div>
        </div>
      </section>

      <!-- Right: Library + 3D操作（統合） -->
      <section class="right-pane">
        <div class="card cardFill">
          <div class="card__head">
            <h2 class="card__title">家具ライブラリ / 3D操作</h2>
            <p class="card__desc">家具を追加し、ダブルクリックで選択 → 完了／削除。</p>
          </div>
          <div class="card__body stack cardFill__scroll">
            <div class="hint">
              <span class="hint__badge">操作</span>
              <span> <b>ダブルクリック</b> で家具を選択</span>
            </div>

            <div class="subTitle">家具ライブラリ</div>
            <div id="libraryList" class="libraryList"></div>

            <div class="subTitle">選択項目</div>
            <div id="placeStatus" class="placeStatus">未選択</div>

            <div class="row">
              <button id="moveDoneBtn" class="btn btnPrimary" type="button">完了</button>
              <button id="moveDeleteBtn" class="btn btnDanger" type="button">削除</button>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- <footer class="appFooter">
    <div class="appFooter__inner"><span>© まどりめいく</span></div>
  </footer> -->

  <script type="module" src="scriptMadori.js"></script>
</body>

</html>
